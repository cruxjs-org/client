import {signal,effect}from'@minejs/signals';import {mount}from'@minejs/jsx';import {EventsManager,WindowManager,createRouter}from'@minejs/browser';import {setupI18n}from'@minejs/i18n';var d,a=class{constructor(e){this.lifecycle="booting";this.hooks={};this.extensions=[];this.routeComponents={};this.currentPathSignal=signal(window.location.pathname??"/");this.config=e,this.debug=e.debug??false,this.log("[INIT] Creating ClientManager"),e.lifecycle&&(this.hooks={...e.lifecycle}),this.extensions=e.extensions??[],this.routeComponents=e.routes,this.eventsManager=new EventsManager,this.windowManager=new WindowManager;let t=Object.entries(e.routes).map(([n,r])=>({path:n,component:r}));this.router=createRouter({routes:t,notFoundComponent:e.notFoundComponent}),this.router.afterEach(n=>{this.currentPathSignal.set(n.path);}),d=this,this.log("[INIT] ClientManager created");}on(e,t,n,r){return typeof e=="string"&&e.startsWith("on")?(this.hooks[e]=t,this):this.eventsManager.on(e,t,n,r)}async boot(){if(this.lifecycle!=="booting"){console.warn("[ClientManager] Already booted or destroyed");return}this.log("\u26A1 Phase: BOOT");try{for(let e of this.extensions)e.onBoot&&(this.log(`\u2192 Extension onBoot: ${e.name}`),await e.onBoot({debug:this.debug,config:{},cconfig:this.config}));this.hooks.onBoot&&(this.log("\u2192 Calling onBoot hook"),await this.hooks.onBoot()),this.log("\u2713 BOOT phase complete");}catch(e){throw console.error("[ClientManager] Boot failed:",e),e}}async ready(){if(this.lifecycle!=="booting"){console.warn("[ClientManager] Cannot ready - not in booting phase");return}this.log("\u26A1 Phase: READY");try{let e="body";document.querySelector(e).id="root",this.mount(e),this.log("\u2192 Router mounted");for(let t of this.extensions)t.onReady&&(this.log(`\u2192 Extension onReady: ${t.name}`),await t.onReady({debug:this.debug,config:{},cconfig:this.config}));this.hooks.onReady&&(this.log("\u2192 Calling onReady hook"),await this.hooks.onReady()),this.lifecycle="ready",this.log("\u2713 READY phase complete"),this.log("\u2713 App is ready!");}catch(e){throw console.error("[ClientManager] Ready failed:",e),e}}async destroy(){if(this.lifecycle==="destroyed"){console.warn("[ClientManager] Already destroyed");return}this.lifecycle="destroying",this.log("\u26A1 Phase: DESTROY");try{for(let e=this.extensions.length-1;e>=0;e--){let t=this.extensions[e];t.onDestroy&&(this.log(`\u2192 Extension onDestroy: ${t.name}`),await t.onDestroy({debug:this.debug,config:{},cconfig:this.config}));}this.hooks.onDestroy&&(this.log("\u2192 Calling onDestroy hook"),await this.hooks.onDestroy()),this.eventsManager.destroy(),this.windowManager.destroy(),this.lifecycle="destroyed",this.log("\u2713 DESTROY phase complete");}catch(e){throw console.error("[ClientManager] Destroy failed:",e),e}}navigate(e){this.router.push(e);}mount(e){let t=typeof e=="string"?document.querySelector(e):e;if(!t){console.warn("[ClientManager] Mount target not found:",e);return}let n=t;if(this.config.rootLayout)try{let r=this.config.rootLayout();if(r){mount(r,t),this.log("\u2192 Root layout mounted");let i=t.querySelector("#main-overlay");i?n=i:console.warn("[ClientManager] Page slot #main-overlay not found in root layout. Pages will render to the root container.");}}catch(r){console.error("[ClientManager] Error rendering root layout:",r),t.innerHTML="<p>Error loading root layout</p>";return}effect(()=>{let r=this.currentPathSignal(),i=this.routeComponents[r]||this.config.notFoundComponent||null;if(n.innerHTML="",i)try{let s=i();s&&mount(s,n);}catch(s){console.error("[ClientManager] Error rendering component:",r,s),n.innerHTML="<p>Error loading component</p>";}else n.innerHTML="<p>No component found for this route</p>";this.log(`\u2192 Route changed to: ${r}`);}),this.router.push(this.currentPathSignal()),this.log("\u2192 Routing setup complete");}getCurrentPath(){return this.currentPathSignal}createLinkHandler(e){return t=>{t.preventDefault(),this.navigate(e);}}getRouter(){return this.router}off(e,t,n){this.eventsManager.off(e,t,n);}getEventsManager(){return this.eventsManager}getViewport(){return this.windowManager.getViewport()}getWindowManager(){return this.windowManager}getI18n(){return window.__i18n}t(e,t,n){return window.__i18n?window.__i18n.t(e,t)??n??e:(console.warn("[ClientManager] i18n not initialized. Using default value or key."),n??e)}getPhase(){return this.lifecycle}isReady(){return this.lifecycle==="ready"}log(e){this.debug&&console.log(`[ClientManager] ${e}`);}},l=()=>d,g=()=>l()?.getRouter(),x=()=>g()?.back(),b=()=>g()?.forward(),L=o=>g()?.push(o),R=o=>g()?.replace(o),h=()=>l()?.getI18n(),k=()=>h()?.getLanguage(),P=o=>h()?.setLanguage(o),T=(o,e,t)=>l()?.t(o,e,t),H=(o,e,t,n)=>h()?.tLang(o,e,t,n)??n??e;async function A(o){let e=document.querySelector('meta[name="app-i18n"]');if(e){let n=JSON.parse(e.getAttribute("content")||"{}");o.i18n=n;}let t=new a(o);return window.__i18n=await setupI18n(o.i18n||{defaultLanguage:"en",supportedLanguages:["en"]}),t.boot(),t.ready(),window.addEventListener("beforeunload",async()=>{await t.destroy();}),t}export{l as CM,a as ClientManager,x as back,b as forward,h as getI18n,k as getLang,g as getRouter,L as push,R as replace,P as setLang,A as start,T as t,H as tLang};//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map